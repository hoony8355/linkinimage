<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>22 CSS-based Image Map Generator</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .resizing {
      outline: 2px dashed #555;
    }
  </style>
</head>
<body>
  <h1>CSS-based Image Map Generator</h1>

  <div class="uploader">
    <div>
      <label>이미지 업로드:
        <input type="file" id="image-upload" accept="image/*" />
      </label>
    </div>
    <div style="margin-top: 1rem;">
      <label>이미지 URL 입력:</label><br />
      <input type="text" id="image-url" placeholder="https://example.com/image.jpg" />
      <button onclick="loadImageFromURL()">불러오기</button>
    </div>
  </div>

  <div id="image-container">
    <img id="preview" src="" alt="Preview" />
  </div>

  <div style="text-align: center">
    <button onclick="addHotspot()">+ 버튼 추가</button>
    <button onclick="generateCode()">코드 생성</button>
  </div>

  <textarea id="code-output" readonly placeholder="코드가 여기에 출력됩니다"></textarea>

  <script>
    const preview = document.getElementById("preview");
    const container = document.getElementById("image-container");
    let imageWidth = 1080, imageHeight = 6503;
    let hotspotIndex = 0;
    let resizingElement = null;

    const colors = ["red", "blue", "green", "orange", "purple", "teal", "brown"];

    document.getElementById("image-upload").addEventListener("change", (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function (event) {
        preview.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    function loadImageFromURL() {
      const url = document.getElementById("image-url").value;
      if (url) {
        preview.src = url;
      }
    }

    preview.onload = () => {
      imageWidth = preview.naturalWidth;
      imageHeight = preview.naturalHeight;
    };

    function addHotspot() {
      const href = prompt("링크 주소를 입력하세요:") || "#";
      const title = prompt("링크 타이틀을 입력하세요:") || "";
      const div = document.createElement("div");
      div.className = "hotspot";

      const color = colors[hotspotIndex % colors.length];
      hotspotIndex++;

      div.style.left = "10%";
      div.style.top = "10%";
      div.style.width = "20%";
      div.style.height = "5%";
      div.style.borderColor = color;
      div.style.backgroundColor = `rgba(${getRGB(color)}, 0.2)`;

      div.setAttribute("data-href", href);
      div.setAttribute("data-title", title);

      const label = document.createElement("span");
      label.innerText = `${title} (${href})`;
      div.appendChild(label);

      const controlWrap = document.createElement("div");
      controlWrap.className = "controls";

      const editBtn = document.createElement("button");
      editBtn.innerText = "✏️";
      editBtn.onclick = () => {
        const newHref = prompt("새 링크 주소:", div.getAttribute("data-href")) || "#";
        const newTitle = prompt("새 타이틀:", div.getAttribute("data-title")) || "";
        div.setAttribute("data-href", newHref);
        div.setAttribute("data-title", newTitle);
        label.innerText = `${newTitle} (${newHref})`;
      };

      const resizeBtn = document.createElement("button");
      resizeBtn.innerText = "📐";
      resizeBtn.onclick = () => {
        if (resizingElement) {
          resizingElement.classList.remove("resizing");
        }
        resizingElement = div;
        div.classList.add("resizing");
      };

      const deleteBtn = document.createElement("button");
      deleteBtn.innerText = "❌";
      deleteBtn.onclick = () => container.removeChild(div);

      controlWrap.appendChild(editBtn);
      controlWrap.appendChild(resizeBtn);
      controlWrap.appendChild(deleteBtn);
      div.appendChild(controlWrap);

      container.appendChild(div);
      makeDraggable(div);
    }

    function getRGB(colorName) {
      const colors = {
        red: "255,0,0",
        blue: "0,0,255",
        green: "0,128,0",
        orange: "255,165,0",
        purple: "128,0,128",
        teal: "0,128,128",
        brown: "165,42,42"
      };
      return colors[colorName] || "0,0,0";
    }

    function makeDraggable(el) {
      let isDragging = false, startX, startY;
      el.addEventListener("mousedown", function (e) {
        if (e.target.classList.contains("controls") || e.target.tagName === 'BUTTON' || e.target.tagName === 'SPAN') return;
        if (resizingElement === el) return; // resizing mode skip dragging
        isDragging = true;
        startX = e.offsetX;
        startY = e.offsetY;
      });
      document.addEventListener("mousemove", function (e) {
        if (isDragging) {
          const rect = container.getBoundingClientRect();
          const x = ((e.clientX - rect.left - startX) / rect.width) * 100;
          const y = ((e.clientY - rect.top - startY) / rect.height) * 100;
          el.style.left = `${x}%`;
          el.style.top = `${y}%`;
        }
        if (resizingElement && e.buttons === 1 && e.target === resizingElement) {
          const rect = container.getBoundingClientRect();
          const right = ((e.clientX - rect.left) / rect.width) * 100;
          const bottom = ((e.clientY - rect.top) / rect.height) * 100;
          const left = parseFloat(resizingElement.style.left);
          const top = parseFloat(resizingElement.style.top);
          resizingElement.style.width = `${right - left}%`;
          resizingElement.style.height = `${bottom - top}%`;
        }
      });
      document.addEventListener("mouseup", () => {
        isDragging = false;
        if (resizingElement) {
          resizingElement.classList.remove("resizing");
          resizingElement = null;
        }
      });
    }

    function generateCode() {
      let output = `<div style=\"position: relative; max-width: ${imageWidth}px; margin: auto;\">\n`;
      output += `  <img src=\"${preview.src}\" style=\"width: 100%; display: block;\" alt=\"포스터\" />\n\n`;

      document.querySelectorAll(".hotspot").forEach((el) => {
        const href = el.getAttribute("data-href") || "#";
        const title = el.getAttribute("data-title") || "";
        output += `  <a href=\"${href}\" target=\"_blank\" title=\"${title}\" style=\"position: absolute; left: ${el.style.left}; top: ${el.style.top}; width: ${el.style.width}; height: ${el.style.height}; display: block;\"></a>\n`;
      });

      output += `</div>`;
      document.getElementById("code-output").value = output;
    }
  </script>
</body>
</html>
